<html>
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
<style>
html {
  height: 100%;
  background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
  overflow: hidden;
}
#stars2 {
  width: 2px;
  height: 2px;
  background: transparent;
  box-shadow: 1907px 1575px #51966e , 893px 268px #519663 , 1819px 666px #519663 , 366px 1985px #519663 , 1736px 1062px #519663 , 1124px 45px #519663 , 905px 1674px #519663 , 1570px 711px #519663 , 255px 1747px #519663 , 147px 1032px #519663 , 865px 1813px #519663 , 1721px 1461px #519663 , 202px 724px #519663 , 1860px 812px #519663 , 634px 1410px #519663 , 927px 1264px #519663 , 1648px 620px #519663 , 1915px 1309px #519663 , 731px 778px #519663 , 91px 1185px #519663 , 829px 1003px #519663 , 174px 1784px #519663 , 1094px 1874px #519663 , 1464px 484px #519663 , 1639px 1717px #519663 , 959px 573px #519663 , 1686px 1287px #519663 , 906px 356px #519663 , 970px 499px #519663 , 626px 890px #519663 , 1344px 1070px #519663 , 1351px 544px #519663 , 708px 68px #519663 , 1870px 130px #519663 , 556px 1270px #519663 , 1432px 618px #519663 , 769px 673px #519663 , 1289px 1410px #519663 , 1499px 1969px #519663 , 749px 1163px #519663 , 1198px 198px #519663 , 399px 133px #519663 , 1856px 1280px #519663 , 904px 194px #519663 , 973px 1107px #519663 , 1371px 1785px #519663 , 989px 1835px #519663 , 1043px 1517px #519663 , 787px 916px #519663 , 1635px 1155px #519663 , 752px 524px #519663 , 1926px 1279px #519663 , 1052px 1163px #519663 , 719px 1963px #519663 , 786px 519px #519663 , 1440px 500px #519663 , 156px 1265px #519663 , 1691px 429px #519663 , 1349px 1474px #519663 , 736px 459px #519663 , 248px 1678px #519663 , 1136px 510px #519663 , 1317px 10px #519663 , 1209px 1323px #519663 , 54px 469px #519663 , 730px 1939px #519663 , 960px 23px #519663 , 112px 941px #519663 , 1852px 1522px #519663 , 1993px 1972px #519663 , 265px 129px #519663 , 222px 1897px #519663 , 1766px 1804px #519663 , 1530px 1786px #519663 , 1045px 432px #519663 , 1916px 1980px #519663 , 309px 1780px #519663 , 1420px 559px #519663 , 1708px 103px #519663 , 324px 1407px #519663 , 1175px 943px #519663 , 80px 1221px #519663 , 1016px 1933px #519663 , 318px 560px #519663 , 190px 1489px #519663 , 1095px 892px #519663 , 1975px 1191px #519663 , 1197px 955px #519663 , 1482px 873px #519663 , 1912px 300px #519663 , 2000px 1636px #519663 , 1473px 1808px #519663 , 507px 192px #519663 , 924px 1300px #519663 , 1485px 1636px #519663 , 41px 1822px #519663 , 689px 120px #519663 , 769px 273px #519663 , 1039px 976px #519663 , 1057px 1520px #519663 , 1417px 1187px #519663 , 512px 1507px #519663 , 519px 45px #519663 , 1207px 1687px #519663 , 1824px 1488px #519663 , 1694px 31px #519663 , 1859px 52px #519663 , 1368px 268px #519663 , 190px 1404px #519663 , 940px 1003px #519663 , 167px 942px #519663 , 1641px 647px #519663 , 1051px 654px #519663 , 233px 1640px #519663 , 554px 511px #519663 , 1705px 1866px #519663 , 240px 1430px #519663 , 140px 668px #519663 , 648px 1617px #519663 , 252px 101px #519663 , 676px 1774px #519663 , 889px 1698px #519663 , 595px 853px #519663 , 249px 1768px #519663 , 1091px 1529px #519663 , 223px 839px #519663 , 239px 699px #519663 , 1547px 356px #519663 , 249px 1130px #519663 , 1209px 1946px #519663 , 1967px 1274px #519663 , 430px 298px #519663 , 1305px 134px #519663 , 156px 91px #519663 , 1712px 264px #519663 , 1256px 991px #519663 , 1887px 1844px #519663 , 1957px 1275px #519663 , 1718px 666px #519663 , 1090px 543px #519663 , 933px 1411px #519663 , 801px 323px #519663 , 202px 1659px #519663 , 1117px 549px #519663 , 290px 1859px #519663 , 1380px 1516px #519663 , 557px 1165px #519663 , 1953px 1758px #519663 , 1901px 1407px #519663 , 1144px 347px #519663 , 1640px 271px #519663 , 1996px 43px #519663 , 838px 488px #519663 , 1151px 1529px #519663 , 306px 460px #519663 , 1666px 635px #519663 , 1572px 633px #519663 , 1797px 1076px #519663 , 1727px 1119px #519663 , 474px 871px #519663 , 1491px 1398px #519663 , 1301px 868px #519663 , 1632px 454px #519663 , 1611px 466px #519663 , 498px 1162px #519663 , 796px 269px #519663 , 1988px 747px #519663 , 502px 12px #519663 , 276px 1260px #519663 , 1536px 974px #519663 , 956px 656px #519663 , 107px 701px #519663 , 965px 491px #519663 , 1646px 247px #519663 , 1515px 921px #519663 , 1813px 519px #519663 , 697px 143px #519663 , 591px 1452px #519663 , 1773px 1411px #519663 , 1622px 1401px #519663 , 534px 340px #519663 , 1590px 284px #519663 , 1464px 528px #519663 , 734px 1718px #519663 , 1929px 1683px #519663 , 656px 480px #519663 , 833px 705px #519663 , 1567px 109px #519663 , 1055px 330px #519663 , 1943px 1367px #519663 , 1935px 1512px #519663 , 355px 1024px #519663 , 1894px 218px #519663 , 1703px 1772px #519663 , 781px 1394px #519663 , 367px 42px #519663 , 100px 690px #519663 , 1831px 458px #519663 , 1884px 1878px #519663 , 814px 1013px #519663;
  animation: animStar 100s linear infinite;
}
#stars3 {
  width: 3px;
  height: 3px;
  background: transparent;
  box-shadow: 1994px 1692px #ac5f5f , 961px 1928px #ac5f5f , 819px 1320px #ac5f5f , 1899px 52px #ac5f5f , 28px 1937px #ac5f5f , 157px 88px #ac5f5f , 860px 1909px #ac5f5f , 720px 427px #ac5f5f , 1319px 1469px #ac5f5f , 677px 960px #ac5f5f , 1265px 1181px #ac5f5f , 1176px 1361px #ac5f5f , 1957px 753px #ac5f5f , 1674px 1355px #ac5f5f , 929px 1206px #ac5f5f , 1038px 898px #ac5f5f , 1229px 365px #ac5f5f , 1085px 51px #ac5f5f , 851px 650px #ac5f5f , 385px 21px #ac5f5f , 41px 1153px #ac5f5f , 718px 70px #ac5f5f , 1321px 579px #ac5f5f , 497px 1458px #ac5f5f , 1981px 813px #ac5f5f , 776px 1187px #ac5f5f , 1345px 31px #ac5f5f , 1571px 400px #ac5f5f , 339px 587px #ac5f5f , 146px 750px #ac5f5f , 64px 61px #ac5f5f , 307px 981px #ac5f5f , 388px 849px #ac5f5f , 1398px 936px #ac5f5f , 522px 765px #ac5f5f , 1146px 350px #ac5f5f , 19px 206px #ac5f5f , 1767px 319px #ac5f5f , 1203px 425px #ac5f5f , 1917px 1018px #ac5f5f , 91px 1401px #ac5f5f , 898px 697px #ac5f5f , 1712px 1121px #ac5f5f , 633px 1119px #ac5f5f , 137px 1266px #ac5f5f , 1006px 931px #ac5f5f , 1644px 1804px #ac5f5f , 1596px 1057px #ac5f5f , 1298px 543px #ac5f5f , 1505px 996px #ac5f5f , 1972px 1383px #ac5f5f , 1210px 1497px #ac5f5f , 804px 1840px #ac5f5f , 913px 1047px #ac5f5f , 187px 1824px #ac5f5f , 1564px 1994px #ac5f5f , 557px 1737px #ac5f5f , 508px 1609px #ac5f5f , 1259px 1911px #ac5f5f , 1294px 1381px #ac5f5f , 1845px 1843px #ac5f5f , 667px 1497px #ac5f5f , 1046px 945px #ac5f5f , 937px 1889px #ac5f5f , 982px 1806px #ac5f5f , 1293px 671px #ac5f5f , 668px 904px #ac5f5f , 358px 1971px #ac5f5f , 133px 766px #ac5f5f , 1152px 1573px #ac5f5f , 318px 694px #ac5f5f , 578px 1184px #ac5f5f , 1620px 1701px #ac5f5f , 1359px 354px #ac5f5f , 1807px 1367px #ac5f5f , 458px 911px #ac5f5f , 1387px 806px #ac5f5f , 523px 81px #ac5f5f , 1243px 341px #ac5f5f , 906px 1730px #ac5f5f , 1629px 474px #ac5f5f , 1690px 419px #ac5f5f , 847px 808px #ac5f5f , 528px 1627px #ac5f5f , 480px 718px #ac5f5f , 537px 593px #ac5f5f , 1432px 1333px #ac5f5f , 200px 1228px #ac5f5f , 1800px 1375px #ac5f5f , 725px 1231px #ac5f5f , 1749px 1432px #ac5f5f , 1948px 303px #ac5f5f , 1889px 252px #ac5f5f , 1114px 1400px #ac5f5f , 759px 646px #ac5f5f , 222px 571px #ac5f5f , 1908px 1401px #ac5f5f , 1856px 1204px #ac5f5f , 338px 1645px #ac5f5f , 1528px 1050px #ac5f5f;
  animation: animStar 150s linear infinite;
}
@keyframes animStar {
  from {
    transform: translateY(0px);
  }
  to {
    transform: translateY(-2000px);
  }
}
body {
  margin:0;
  padding:0;
  display:flex;
  overflow:hidden;
}
#score {
  position:absolute;
  z-index:1;
  left:0;
  top:20px;
  width:200px;
  font-family:'Orbitron';
  font-size:24pt;
  color:white;
  text-align:right;
  user-select:none;
}
#copy {
  font-family:'Orbitron';
  font-size:16pt;
  color:#909090;
  position:absolute;
  z-index:1;
  bottom:20px;
  width:100%;
  text-align:center;
  user-select:none;
}
@keyframes pulse {
  0% {
    opacity:1;
  }
  50% {
    opacity:0.1;
  }
  100% {
    opacity:1;
  }
}
.blueprint {
  display:none;
}
#screen {
  background-color:black;
  flex:1;
}
.sprite {
  transition:transform 0s ease-in-out;
  position:absolute;
}
.rot {
  transition:all ease;
}
.frame {
  position:absolute;
  top:0;
  left:0;
}
.hide {
  display:none !important;
}
.life {
  z-index:1;
}
.life .frame {
  z-index:1;
  width:30px;
}
.ship {
  z-index:10;
}
.ship .frame {
  z-index:10;
  width:50px;
}
.ship .frame.thrust {
  display:none;
  z-index:9;
}
@keyframes dive {
  0% {
    transform:scale(1.5) rotate(1turn);
  }
  1% {
    transform:scale(1.5) rotate(1turn);
  }
  2% {
    transform:scale(1.5) rotate(1turn);
  }
  20% {
    transform:scale(1) rotate(0turn);
  }
  100% {
    transform:scale(0) rotate(1turn);
  }
}
.pow {
  position:absolute;
}
.pow svg {
  animation:expander 0.6s 1;
  opacity:0;
}
.xship {
  height:100px;
  width:100px;
  z-index:12;
}
.xufob {
  height:100px;
  width:100px;
  z-index:5;
}
.xufos {
  height:50px;
  width:50px;
  z-index:5;
}
@keyframes hyperout {
  from {
    transform:scale(1);
    opacity:1;
  }
  to {
    transform:scale(10);
    opacity:0;
  }
}
@keyframes hyperin {
  from {
    transform:scale(10);
    opacity:0;
  }
  to {
    transform:scale(1);
    opacity:1;
  }
}
@keyframes expander {
  0% {
    transform:scale(0.5);
    opacity:1;
  }
  20% {
    transform:scale(3) rotate(25deg);
  }
  40% {
    transform:scale(2);
  }
  60% {
    transform:scale(1) rotate(-25deg);
  }
  100% {
    transform:scale(0);
    opacity:0;
  }
}
.ship .frame.thrusting {
  display:block;
  animation:athrusting 0.4s ease infinite;
}
@keyframes athrusting {
  0% {
    transform:scale(0.3)
  }
  25% {
    transform:scale(1.2)
  }
  50% {
    transform:scale(0.5)
  }
  75% {
    transform:scale(1.2)
  }
  100% {
    transform:scale(0.3)
  }
}
.ufo {
  z-index:10;
  top:400;
  left:400;
}
.us .frame {
  width:30px;
}
.ub .frame {
  width:60px;
}
@keyframes ufobulge {
  0% {
    transform:scaleX(1)
  }
  25% {
    transform:scaleX(1.4)
  }
  50% {
    transform:scaleX(1)
  }
  75% {
    transform:scaleX(1)
  }
}
.rock {
  position:absolute;
  z-index:5;
}
.rb .frame {
  width:120px;
  animation:rotatecw 10s linear infinite;
}
.ccw .frame {
  animation-name:rotateccw !important;
}
.rm .frame {
  width:60px;
  animation:rotatecw 3s linear infinite;
}
.rs .frame {
  width:30px;
  animation:rotatecw 1s linear infinite;
}
@keyframes rotatecw {
  from {
    transform:rotate(0deg);
  }
  to {
    transform:rotate(1turn);
  }
}
@keyframes rotateccw {
  from {
    transform:rotate(0deg);
  }
  to {
    transform:rotate(-1turn);
  }
}
.shot {
  border-radius:50%;
  display:inline-block;  
  position:absolute;
  z-index:8;
}
.sshot {
  height:4px;
  width:4px;
  background-color:rgb(148, 176, 255);
}
.ushot {
  height:6px;
  width:6px;
  background-color:rgb(255, 113, 224);
}
.xrock {
  position:absolute;
  opacity:0;
  z-index:20;
}
.xrock div {
  background-color:white;
  border-radius:50%;
  display:inline-block;  
  position:absolute;
}
.xrb {
  width:120px;
  height:120px;
}
.xrb div {
  height:6px;
  width:6px;
}
.xrm {
  width:60px;
  height:60px;
}
.xrm div {
  height:4px;
  width:4px;
}
.xrs {
  width:50px;
  height:50px;
}
.xrs div {
  height:3px;
  width:3px;
}
@keyframes agrow {
  0% {
    transform:rotate(-4deg) scale(0.5);
    opacity:1;
  }
  50% {
    transform:rotate(0deg) scale(1);
    opacity:0.7;
  }
  100% {
    transform:rotate(4deg) scale(1.5);
    opacity:0;
  }
}
@keyframes bulge {
  0% {
    transform:scale(0.5);
  }
  100% {
    transform:scale(1);
  }
}
#highscore {
  position:absolute;
  z-index:1;
  left:0;
  width:100%;
  text-align:center;
  top:20px;
  font-family:'Orbitron';
  font-size:14pt;
  color:white;
  user-select:none;
}
#gameover, #start {
  font-family:'Orbitron';
  font-size:44pt;
  font-weight:bold;
  color:white;
  position:absolute;
  width:100%;
  text-align:center;
  user-select:none;
  top:28%;
  display:none;
  user-select:none;
}
#gameover {
  z-index:20;  
}
#start {
  z-index:1;
}
#congrats {
  font-family:'Orbitron';
  font-size:30pt;
  color:#a0a0a0;
  position:absolute;
  z-index:20;  
  width:100%;
  text-align:center;
  user-select:none;
  top:40%;
  display:none;
  user-select:none;
}
#inits {
  margin-top:20px;
}
#inits span {
  color:white;
  font-size:40pt;
  font-weight:bold;
  border-bottom:4px solid #a0a0a0;
  margin:0 4px;
  width:1.3em;
  display:inline-block;
  user-select:none;
}
#inits .curs {
  background-color:white;
  animation:curs 1s ease infinite;
}
@keyframes textgrow {
  from {
    transform:scale(0.5);
    opacity:0;
  }
  to {
    transform:scale(1);
    opacity:1;
  }
}
@keyframes curs {
  0% {
    background-color:white;
  }
  33% {
    background-color:#404040;
  }
  66% {
    background-color:white;
  }
}
#welcome, #highscores {
  font-family:'Orbitron';
  color:white;
  position:absolute;
  z-index:20;  
  width:100%;
  text-align:center;
  user-select:none;
  top:6%;
  user-select:none;
  text-shadow:-1px -1px 0px #000,0px -1px 0px #000,1px -1px 0px #000,-1px  0px 0px #000,1px  0px 0px #000,-1px  1px 0px #000,0px  1px 0px #000,1px  1px 0px #000;
  display:none;
  animation:fadein 3s normal 1;
}
@keyframes fadein {
  0% {
    opacity:0;
  }
  50% {
    opacity:0;
  }
  100% {
    opacity:1;
  }
}
#welcome h1, #highscores h1 {
  font-size:46pt;
  line-height:46pt;
  margin-bottom:0.4em;
}
#welcome h1 {
  color:rgb(0, 255, 21);
  font-size:72pt;
}
#welcome h2 {
  margin-top:1.5em;
  font-size:30pt;
}
#welcome div {
  font-size:22pt;
  width:610px;
  margin:0 auto;
  padding-bottom:0.3em;
  text-align:left;
}
#highscores div {
  font-size:28pt;
  width:430px;
  text-align:left;
  margin:0 auto;
}
#welcome .keys {
  display:inline-block;
  width:250px;
  text-align:center;
  padding-right:10px;
}
#welcome .keys span {
  background-color:#e0e0e0;
  color:black;
  display:inline-block;
  width:90px;
  font-size:30pt;
  border-radius:10px;
}
#welcome .keys span.sb {
  background-color:#e0e0e0;
  color:black;
  display:inline-block;
  width:250px;
  font-size:24pt;
  height:60px;
  line-height:60px;
}
#highscores .rank {
  display:inline-block;
  width:50px;
  text-align:center;
  padding-right:15px;
  color:#a0a0a0;
}
#highscores .score {
  display:inline-block;
  width:210px;
  text-align:right;
}
#highscores .inits {
  display:inline-block;
  width:150px;
  text-align:right;
}
#press1 {
  font-family:'Orbitron';
  font-size:26pt;
  color:white;
  position:absolute;
  z-index:20;
  bottom:50px;
  width:100%;
  text-align:center;
  user-select:none;
  animation:pulse 1s infinite;
  text-shadow:-1px -1px 0px #000,0px -1px 0px #000,1px -1px 0px #000,-1px  0px 0px #000,1px  0px 0px #000,-1px  1px 0px #000,0px  1px 0px #000,1px  1px 0px #000;
}
</style>
</head>
<body>
  <div id='xrockbp' class='blueprint'>
    <div style='top:10%; left:44%'></div><div style='top:20%; left:82%'></div><div style='top:30%; left:66%'></div><div style='top:40%; left:23%'></div><div style='top:50%; left:45%'></div><div style='top:60%; left:62%'></div><div style='top:70%; left:12%'></div><div style='top:80%; left:2%'></div><div style='top:90%; left:99%'></div><div style='top:100%; left:56%'></div><div style='top:52%; left:10%'></div><div style='top:22%; left:20%'></div><div style='top:56%; left:30%'></div><div style='top:77%; left:40%'></div><div style='top:2%; left:50%'></div><div style='top:83%; left:60%'></div><div style='top:52%; left:70%'></div><div style='top:72%; left:80%'></div><div style='top:11%; left:90%'></div><div style='top:29%; left:100%'></div><div style='top:10%; left:10%'></div>
  </div>
  <div id='powbp' class='blueprint'>
    <svg viewbox="0 0 720 720">
      <g>
        <path d="m 329.6885371631169,144.9454094414912 c 0,0 -9.3691648630806,-18.5615530306314 -37.6534361478519,-6.3639610390736" id="path2983" style="fill:none;stroke:#ff0000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;display:none"/>
        <path d="m 326.8905349710195,144.9454094414912 c 0,0 -9.3691648630806,-18.5615530306314 -37.6534361478519,-6.3639610390736" id="path2983-8" style="fill:none;stroke:#ff0000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;display:none"/>
        <path d="M 94.6324614631855,36.00250586938022 300.1705854663462,193.5309023590188 342.0166705927379,44.6173400524073 401.0934966535268,195.9922835541695 564.785535530295,54.46286483300981 476.1702964391128,237.8357638717294 616.4777583334849,232.9130014814282 525.4009848231031,347.3672270559314 647.2469385734796,426.1314253007506 502.0164078407082,428.5928064959011 630.0161976390828,582.4291311928135 446.6318834087184,497.5114799601184 426.9396080551219,662.4240200352077 337.0936017543393,529.5094354970756 211.5553463751634,700.5754285600419 223.863018471161,486.4352645819405 52.7863763367938,520.8946013140482 159.8631235719732,380.5958731904649 72.47865169038992,237.8357638717299 194.3246054407665,261.2188852256607 94.6324614631855,36.00250586938069 z" id="path3508" style="fill:#ff0000;stroke:none"/>
        <path d="m 160.1985233083172,118.7982717399246 154.3242216264676,118.2770704473064 31.419302606586,-111.8087931572194 44.3566625034159,113.6568723829586 122.9049190198811,-106.2645554800019 -66.5349937551232,137.6819023175674 105.347073445612,-3.6961584514783 -68.3831880260988,85.9356839968712 91.4856164132948,59.1385352236531 -109.0434619875631,1.8480792257391 96.1061020907337,115.5049516086972 -137.6904731876862,-63.7587332880004 -14.7855541678056,123.8213081245232 -67.4590908906114,-99.7962781899145 -94.2579078197586,128.4415061888714 9.2409713548783,-160.7828926393062 -128.4495018328083,25.8731091603477 80.3964507874411,-105.3405158671315 -65.6108966196359,-107.1885950928715 91.4856164132951,17.5567526445221 -74.8518679745143,-169.0992491551333 z" id="path3512" style="fill:#ff8000;stroke:none"/>
        <path d="m 226.2365903979516,204.2096633100054 99.1022747159463,75.9539014973134 20.1765110200129,-71.8001725091792 28.4844861459008,72.9869522200746 78.9257636959331,-68.2398333764925 -42.7267292188508,88.4150884617163 67.6506545965139,-2.373559421791 -43.9135828082631,55.1852565566419 58.7492526759201,37.9769507486567 -70.0243617753388,1.1867797108955 61.7163866494512,74.17373193097 -88.4205924112332,-40.9439000258953 -9.4948287153004,79.5142406299997 -43.3201560135574,-64.0861043883581 -60.529533060039,82.4811899072385 5.9342679470626,-103.2498348479099 -82.4863244641708,16.614915952537 51.6281311394449,-67.6464435210443 -42.1333024241446,-68.8332232319403 58.7492526759201,11.2744072535075 -48.0675703712075,-108.5903435469403 z" id="path3514" style="fill:#ffff00;stroke:none"/>
        <path d="m -57.96064186096192,305.2593994140625 a 30.91234397888183,30.91234397888183 0 1 1 -61.82468795776368,0 30.91234397888183,30.91234397888183 0 1 1 61.82468795776368,0 z" transform="translate(435.3488372093023,54.09660107334526)" id="path3516" style="fill:#000000;fill-opacity:1;stroke:none"/>
      </g>
    </svg>
  </div>
  <div id='ufopowbp' class='blueprint'>
    <svg viewbox="0 0 720 720">
      <g>
        <path d="m 329.6885371631169,144.9454094414912 c 0,0 -9.3691648630806,-18.5615530306314 -37.6534361478519,-6.3639610390736" id="path2983" style="fill:none;stroke:#00ff80;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;display:none"/>
        <path d="m 326.8905349710195,144.9454094414912 c 0,0 -9.3691648630806,-18.5615530306314 -37.6534361478519,-6.3639610390736" id="path2983-8" style="fill:none;stroke:#00ff80;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;display:none"/>
        <path d="M 94.6324614631855,36.00250586938022 300.1705854663462,193.5309023590188 342.0166705927379,44.6173400524073 401.0934966535268,195.9922835541695 564.785535530295,54.46286483300981 476.1702964391128,237.8357638717294 616.4777583334849,232.9130014814282 525.4009848231031,347.3672270559314 647.2469385734796,426.1314253007506 502.0164078407082,428.5928064959011 630.0161976390828,582.4291311928135 446.6318834087184,497.5114799601184 426.9396080551219,662.4240200352077 337.0936017543393,529.5094354970756 211.5553463751634,700.5754285600419 223.863018471161,486.4352645819405 52.7863763367938,520.8946013140482 159.8631235719732,380.5958731904649 72.47865169038992,237.8357638717299 194.3246054407665,261.2188852256607 94.6324614631855,36.00250586938069 z" id="path3508" style="fill:#00ff80;stroke:none"/>
        <path d="m 160.1985233083172,118.7982717399246 154.3242216264676,118.2770704473064 31.419302606586,-111.8087931572194 44.3566625034159,113.6568723829586 122.9049190198811,-106.2645554800019 -66.5349937551232,137.6819023175674 105.347073445612,-3.6961584514783 -68.3831880260988,85.9356839968712 91.4856164132948,59.1385352236531 -109.0434619875631,1.8480792257391 96.1061020907337,115.5049516086972 -137.6904731876862,-63.7587332880004 -14.7855541678056,123.8213081245232 -67.4590908906114,-99.7962781899145 -94.2579078197586,128.4415061888714 9.2409713548783,-160.7828926393062 -128.4495018328083,25.8731091603477 80.3964507874411,-105.3405158671315 -65.6108966196359,-107.1885950928715 91.4856164132951,17.5567526445221 -74.8518679745143,-169.0992491551333 z" id="path3512" style="fill:#00eeff;stroke:none"/>
        <path d="m 226.2365903979516,204.2096633100054 99.1022747159463,75.9539014973134 20.1765110200129,-71.8001725091792 28.4844861459008,72.9869522200746 78.9257636959331,-68.2398333764925 -42.7267292188508,88.4150884617163 67.6506545965139,-2.373559421791 -43.9135828082631,55.1852565566419 58.7492526759201,37.9769507486567 -70.0243617753388,1.1867797108955 61.7163866494512,74.17373193097 -88.4205924112332,-40.9439000258953 -9.4948287153004,79.5142406299997 -43.3201560135574,-64.0861043883581 -60.529533060039,82.4811899072385 5.9342679470626,-103.2498348479099 -82.4863244641708,16.614915952537 51.6281311394449,-67.6464435210443 -42.1333024241446,-68.8332232319403 58.7492526759201,11.2744072535075 -48.0675703712075,-108.5903435469403 z" id="path3514" style="fill:#0066ff;stroke:none"/>
        <path d="m -57.96064186096192,305.2593994140625 a 30.91234397888183,30.91234397888183 0 1 1 -61.82468795776368,0 30.91234397888183,30.91234397888183 0 1 1 61.82468795776368,0 z" transform="translate(435.3488372093023,54.09660107334526)" id="path3516" style="fill:#000000;fill-opacity:1;stroke:none"/>
      </g>
    </svg>
  </div>
  <div id='ufobp' class='blueprint'>
    <div class='frame'>
      <svg viewBox="0 0 512 512">
        <path style="fill:#FF5023;" d="M298.667,85.333c0-23.565-19.102-42.667-42.667-42.667c-23.565,0-42.667,19.102-42.667,42.667c0,15.791,8.583,29.567,21.333,36.945v34.166h42.667v-34.166C290.082,114.9,298.667,101.124,298.667,85.333z"/>
        <path style="fill:#BF3C1A;" d="M256,42.667v113.778h21.333v-34.166c12.749-7.378,21.333-21.154,21.333-36.945C298.667,61.769,279.565,42.667,256,42.667z"/>
        <rect x="184.889" y="241.778" style="fill:#1E2E3B;" width="142.222" height="56.889"/>
        <path style="fill:#BFE4F8;" d="M426.667,305.778H384c0-70.579-57.421-128-128-128s-128,57.421-128,128H85.333c0-94.107,76.56-170.667,170.667-170.667S426.667,211.671,426.667,305.778z"/>
        <path style="fill:#93C7EF;" d="M256,135.111v42.667c70.579,0,128,57.421,128,128h42.667C426.667,211.671,350.106,135.111,256,135.111z"/>
        <polygon style="fill:#93C7EF;" points="389.794,374.044 122.206,374.044 63.566,469.333 113.664,469.333 148.673,412.444 234.667,412.444 234.667,469.333 277.333,469.333 277.333,412.444 363.327,412.444 398.336,469.333 448.434,469.333 "/>
        <path style="fill:#5a8cb3;" d="M512,327.111c0,23.563-0.001,56.889-0.001,56.889H0c0,0,0-33.326,0-56.889l0,0c0-23.563,19.102-42.667,42.667-42.667h426.667C492.898,284.444,512,303.548,512,327.111L512,327.111z"/>
        <g>
          <circle style="fill:#FFDA44;" cx="64" cy="334.222" r="21.333"/>
          <circle style="fill:#FFDA44;" cx="160" cy="334.222" r="21.333"/>
        </g>
        <path style="fill:#5A8BB0;" d="M469.333,284.444H256V384h255.999c0,0,0.001-33.326,0.001-56.889C512,303.548,492.898,284.444,469.333,284.444z"/>
        <circle style="fill:#FFDA44;" cx="256" cy="334.222" r="21.333"/>
        <g>
          <path style="fill:#FF9811;" d="M256,312.889c11.782,0,21.333,9.552,21.333,21.333s-9.552,21.333-21.333,21.333"/>
          <circle style="fill:#FF9811;" cx="352" cy="334.222" r="21.333"/>
          <circle style="fill:#FF9811;" cx="448" cy="334.222" r="21.333"/>
        </g>
      </svg>
    </div>
  </div>
  <div id='shipbp' class='blueprint'>
    <div class='frame'>
      <div class='rot'>
        <svg viewBox="0 0 460 460">
          <g>
            <path d="m391.78,356.97l0,-51.543c0,-22.857 -11.084,-37.559 -14.882,-41.925l-76.866,-83.428l0,152.156l80.955,37.293c3.02,1.172 10.793,2.713 10.793,-12.553z" fill="#3A5D74" id="svg_5"/>
            <path d="m62.219,356.97l0,-51.543c0,-22.857 11.084,-37.559 14.882,-41.925l76.866,-83.428l0,152.156l-80.953,37.293c-3.022,1.172 -10.795,2.713 -10.795,-12.553z" fill="#3A5D74" id="svg_6"/>
          </g>
          <path stroke="null" d="m227.999,118.143c-4.599,0 -8.328,-2.93362 -8.328,-6.55167l0,-68.03966c0,-3.61805 3.729,-6.55167 8.328,-6.55167s8.328,2.93362 8.328,6.55167l0,68.03966c0,3.61805 -3.729,6.55167 -8.328,6.55167z" fill="#90C8EC" id="svg_7"/>
          <path d="m234.525,65.363l-15.052,0c-37.406,0 -67.728,25.34943 -67.728,56.61843l0,213.29197c0,8.56629 8.306,15.51161 18.557,15.51161l113.395,0c10.248,0 18.557,-6.94532 18.557,-15.51161l0,-168.44331l0,-22.74284l0,-22.10666c-0.001,-31.269 -30.323,-56.61759 -67.729,-56.61759z" fill="#CAE9F7" id="svg_8" stroke="null"/>
          <path d="m151.746,305.426l0,26.803c0,10.247 8.306,18.555 18.557,18.555l113.395,0c10.248,0 18.557,-8.308 18.557,-18.555l0,-26.803l-150.509,0z" fill="red" id="svg_9"/>
          <circle cx="227" cy="229.137" r="32.988" fill="#00aeff" id="svg_10"/>
          <g stroke="null">
            <path d="m81.726,364.405l0,-51.543c0,-22.857 11.084,-37.559 14.882,-41.925l58.358,-63.341l0,-28.523l-76.866,83.428c-3.798,4.365 -14.882,19.067 -14.882,41.925l0,51.543c0,15.265 7.773,13.725 10.795,12.552l7.722,-3.558c-0.002,-0.186 -0.009,-0.365 -0.009,-0.558z" opacity="0.1" fill="#231F20" id="svg_12"/>
            <path d="m171.253,336.33464l0,-214.13126c0,-30.90527 29.397,-56.03216 66,-56.80345c-0.576,-0.01175 -1.147,-0.03693 -1.728,-0.03693l-15.052,0c-37.406,0 -67.728,25.44917 -67.728,56.84121l0,214.13126c0,8.6 8.306,15.57265 18.557,15.57265l18.508,0c-10.251,-0.00084 -18.557,-6.97265 -18.557,-15.57349l0,0.00001z" opacity="0.1" fill="#231F20" id="svg_13" stroke="null"/>
            <path d="m213.519,228.141c0,-15.005 10.021,-27.662 23.733,-31.664c-2.937,-0.856 -6.04,-1.325 -9.253,-1.325c-18.22,0 -32.988,14.769 -32.988,32.989c0,18.219 14.768,32.988 32.988,32.988c3.214,0 6.316,-0.467 9.253,-1.325c-13.713,-4.002 -23.733,-16.658 -23.733,-31.663z" opacity="0.1" fill="#231F20" id="svg_14"/>
          </g>
        </svg>    
      </div>
    </div>
    <div class='frame thrust'>
      <div class='rot'>
        <svg viewbox="0 0 460 460">
          <g>
            <path fill="#FF9737" d="m283.641,334.709c-0.816,-2.159 -2.885,-3.587 -5.192,-3.587l-98.899,0c-2.309,0 -4.375,1.428 -5.194,3.587c-4.157,10.99 -6.266,22.565 -6.266,34.405c0,38.873 23.042,73.976 58.701,89.428c0.705,0.305 1.457,0.457 2.208,0.457c0.752,0 1.504,-0.152 2.208,-0.457c35.66,-15.452 58.701,-50.554 58.701,-89.428c0.001,-11.844 -2.108,-23.419 -6.267,-34.405z"/>
            <path fill="#FFD960" d="m265.446,328.352c-1.052,-1.136 -2.528,-1.782 -4.076,-1.782l-64.742,0c-1.548,0 -3.025,0.645 -4.076,1.782c-1.049,1.135 -1.579,2.659 -1.459,4.202c1.681,21.554 15.743,40.738 35.824,48.871c0.668,0.271 1.376,0.406 2.084,0.406c0.708,0 1.416,-0.135 2.084,-0.406c20.08,-8.133 34.14,-27.316 35.822,-48.871c0.117,-1.544 -0.412,-3.067 -1.461,-4.202z"/>
          </g>
        </svg>     
      </div>
    </div>
  </div>
  <div id='rockbp1' class='blueprint'>
    <div class='frame'>
      <div class='rot'>
        <svg viewbox="0 0 200 200">
          <g style="stroke:white; stroke-width:12; stroke-linejoin:round; stroke-opacity:0.8; fill-opacity:0.4; fill:hsl(39, 18%, 55%);">
            <path d="m7,109.9369l0,-64.37379l71.46798,0.86408l-21.07389,-35.42719l84.29556,0.86408l51.31034,32.83496l0,26.78641l-54.97537,27.65049l53.14286,31.1068l-43.06404,58.75729l-30.23645,-19.87379l-65.05419,19.87379l-45.81281,-79.06312z"/>
          </g>
        </svg>
      </div>
    </div>
  </div>
  <div id='screen'>
    <div id='stars2'></div>
    <div id='stars3'></div>
    <div id='score'></div>
    <div id='highscore'>00</div>
    <div id='gameover'>GAME OVER</div>
    <div id='start'>START PLAYER 1</div>
    <div id='welcome'>
      <h1>ASTEROIDS.js</h1>
      <h2>CONTROLS</h2>
      <div>
        <span class='keys'>
          <span>A</span>
          <span>S</span>
        </span>
        Rotate left and right
      </div>
      <div>
        <span class='keys'>
          <span>K</span>
        </span>
        Thrusters on
      </div>
      <div>
        <span class='keys'>
          <span>L</span>
        </span>
        Fire phaser
      </div>
      <div>
        <span class='keys'>
          <span class='sb'>SPACEBAR</span>
        </span>
        Jump to hyperspace
      </div>
    </div>
    <div id='highscores'>
      <h1>HIGH SCORES</h1>
      <div id='list'></div>
    </div>
    <div id='congrats'>
      <div>Your score is one of the ten best!</div>
      <div>Please enter your initials:</div>
      <div id='inits'>
        <span class='curs'>&nbsp;</span><span>&nbsp;</span><span>&nbsp;</span>
      </div>
    </div>
    <div id='press1'>PRESS 1 TO START</div>
    <div id='copy'>&copy;2022 by Warren</div>
  </div>
</body>
<script>
/** 
 * LCD simple
 * JavaScript library (c)2022 Warren Hornsby 
 **/
const $ = document.querySelector.bind(document);
const $$ = document.querySelectorAll.bind(document);
Node.prototype.on = window.on = function(event, fn, options) {
  this._events = this._events || {};
  this._events[event] = this._events[event] || [];
  this._events[event].push(fn);
  this.addEventListener(event, fn, options);
  return this;
}
Node.prototype.on_once = window.on_once = function(event, fn) {
  this.addEventListener(event, fn, {once:true});
  return this;
}
NodeList.prototype.on = function(name, fn, options) {
  this.forEach((elem, i) => {elem.on(name, fn, options)});
  return this;
}
HTMLElement.prototype.$ = HTMLElement.prototype.querySelector;
HTMLElement.prototype.$$ = HTMLElement.prototype.querySelectorAll;
Object.assign(Object, {
  isObject:e => e && typeof e === 'object' && ! Array.isArray(e),
  isEmpty:e => Object.keys(e).length === 0
})
Object.assign(Function, {
  isFunction:e => typeof e === 'function'
})
const each = (items, fn) => {
  let r;
  if (items) {
    if (Array.isArray(items)) {
      for (var i = 0; i < items.length; i++) {
        r = fn.call(items, items[i], i);
        if (r) {
          break;
        }        
      }
    } else {
      for (var i in items) {
        if (! Function.isFunction(items[i])) {
          r = fn.call(items, items[i], i);
          if (r) {
            break;
          }
        }     
      }
    }
  }
  return r;
}
const wait = (ms, fn) => setTimeout(fn, ms);
const rnd = max => Math.floor(Math.random() * Math.floor(max));
const js = JSON.stringify;
const pojo = o => clone(o, 'toPojo');
const clone = (o, fname) => {
  let p = Array.isArray(o) ? [] : {};
  each(o, (val, fid) => {
    if (Array.isArray(val)) {
      p[fid] = clone(val, fname);
    } else if (Object.isObject(val)) {
      p[fid] = (val[fname]) ? val[fname]() : clone(val, fname);
    } else if (Array.isArray(val)) {
      p[fid] = clone(val, fname);
    } else {
      p[fid] = val;
    }
  })
  return p;
}
class Storage {
  //
  constructor(key) {
    this.key = key;
  }
  save(o) {
    localStorage.setItem(this.key, js(o));
  }
  fetch() {
    let s = localStorage.getItem(this.key);
    return s && JSON.parse(s);
  }
  erase() {
    localStorage.removeItem(this.key);
  }
}
class Obj {
  //
  on(event, fn) {
    this['on' + event] = fn;
    return this;
  }
  priv(...fids) {
    fids.forEach(fid => Object.defineProperty(this, fid, {enumerable:false}));
  }
}
class ObjArray extends Array {
  //
  on(event, fn) {
    this['on' + event] = fn;
    return this;
  }
}
class StorableObj extends Obj {
  //
  constructor(key) {
    super();
    this._storage = new Storage(key || Window.location);
    this.priv('_storage');
    this.fetch();
  }
  fetch() {
    let o = this._storage.fetch();
    this.mixPojo(o);
  }
  mixPojo(o) {
    Object.assign(this, o);
  }
  save() {
    this._storage.save(pojo(this));
  }
}
/** 
 * LCD gaming 
 * 1.0 (c)2022 Warren Hornsby 
 **/
 var LG = {};
//
LG.Obj = class extends Obj {}
LG.Array = class extends ObjArray {}
LG.Controller = class extends LG.Obj {
  //
  constructor() {
    super();
    this.period = 1 / this.frequency();
    this.periodms = this.period * 1000;
    this.sprites = new LG.Sprites();
    this.reset();
  }
  frequency() {
    return 50;
  }
  reset() {
    this.time0 = new Date().getTime();
    this.fix/*frame index*/ = 0;
  }
  start(reset) {
    if (reset) {
      this.reset();
    }
    this.paused = 0;
    this.timep0 = 0;
    if (this.clock) {
      clearInterval(this.clock);
    }
    this.clock = setInterval(() => this.step(this.fix++), this.periodms);
  }
  pause() {
    this.paused = ! this.paused;
    if (this.paused) {
      this.clock = clearInterval(this.clock);
      this.timep0 = new Date().getTime();
    } else {
      this.time0 += (new Date().getTime() - this.timep0);
      this.timep0 = 0;
      this.start();
    }
  }
  step(fix) {
    this.sprites.forEach(sprite => sprite.step(fix));
  }
  elapsed() {
    let ms = this.paused ? (this.timep0 - this.time0) : (new Date().getTime() - this.time0);
    return ms / 1000; // seconds
  }
  sprite(sprite) {
    if (sprite.length) {
      this.sprites = this.sprites.concat(sprite);
    } else {
      this.sprites.push(sprite);
    }
    return sprite;
  }
}
LG.Sprites = class extends LG.Array {
  //
  alive(classname) {
    return this.filter(s => s.alive() && (! classname || s.name() == classname.name));
  }
  of(classname) {
    return this.filter(s => s.name() == classname.name);
  }
  append(sprites) {
    this.splice(this.length, 0, ...sprites);
  }
}
LG.Sprite = class extends LG.Obj {
  /**
   * i x, y, iheading
   * b dead
   * Compass compass
   * $e outermost <div>
   * $$frames children of <$e>
   * $frame first frame (or $e if no frames)
   * $$rot rotatable elements (child of a frame)
   */
  //
  constructor($screen, html, className, x, y, iheading = 0, heading = 0) {
    super();
    this.iheading = iheading || 0;
    this.dead = 0;
    this.compass = new LG.Compass();
    this.$create(html, $screen, className);
    this.moveTo(x, y).heading(heading);
  }
  static is(sprite) {
    return this.name == sprite.name();
  }
  //
  alive() {
    return ! this.dead;
  }
  step(fix) {
    // called from controller
  }
  show(b) {
    this.$e.classList.toggle('hide', ! b);
    return this;
  }
  kill(remove) {
    this.dead = 1;
    remove && this.$e.remove();
  }
  name() {
    return this.constructor.name;
  }
  moveTo(x, y) {
    this.x = x;
    this.y = y;
    this.ix = 0;
    this.iy = 0;
    this.$e.style.left = this.x;
    this.$e.style.top = this.y;
    this.setTranslateCss();
    return this;
  }
  moveByVector(v) {
    this.ix += v.x;
    this.iy += v.y;
    this.setTranslateCss();
    return this;
  }
  heading(heading) {
    this.compass.set(heading);
    this.setRotateCss();
    return this;
  }
  rotate(deg) {
    this.compass.rotate(deg);
    this.setRotateCss();
    return this;
  }
  advance(speed = 1) {
    this.ix = this.compass.advanceX(this.ix, speed); 
    this.iy = this.compass.advanceY(this.iy, speed);
    this.setTranslateCss();
  }
  bounds() {
    let b = this.$e.getBoundingClientRect();
    b.height = this.bf.height;
    b.width = this.bf.width;
    b.cx = Math.floor(b.x + (b.width / 2));
    b.cy = Math.floor(b.y + (b.height / 2));
    b.x2 = b.x + b.width;
    b.y2 = b.y + b.height;
    return b;
  }
  contains(x, y, b) {
    b = b || this.bounds();
    return x >= b.x && x <= b.x2 && y >= b.y && y <= b.y2;
  }
  withinCircle(x, y, fudge = 1.5) {
    let b = this.bounds();
    return this.distanceFrom(x, y, b) * fudge <= b.width;
  }
  distanceFrom(x, y, b) {
    b = b || this.bounds();
    return Math.sqrt(Math.pow(x - b.cx, 2) + Math.pow(y - b.cy, 2));
  }
  //
  $create(html, $screen, className) {
    this.$e = document.createElement('div');
    this.$e.className = 'sprite ' + className;
    if (html) {
      this.$e.innerHTML = html;
      this.$$frames = this.$e.$$('.frame');
      this.$frame = this.$$frames ? this.$$frames[0] : this.$e;
      this.$$rots = this.$e.$$('.rot');
    } else {
      this.$frame = this.$e;
    }
    $screen.appendChild(this.$e);
    this.bf = this.$frame.getBoundingClientRect();
  }
  setTranslateCss() {
    this.$e.style.transform = 'translate(' + this.ix + 'px,' + this.iy + 'px)';
  }
  setRotateCss() {
    if (! this.$$rots) {
      return;
    }
    let nr = this.iheading - this.compass.heading;
    if (nr < 360) {
      nr += 360;
    }
    let rot = this.prevRot || 0;
    let ar = rot % 360;
    if (ar < 0) {
      ar += 360;
    }
    if (ar < 180 && (nr > (ar + 180))) { 
      rot -= 360; 
    }
    if (ar >= 180 && (nr <= (ar - 180))) {
      rot += 360; 
    }
    rot += (nr - ar);
    this._rot = rot;
    this.prevRot = rot;
    this.$$rots.forEach($e => $e.style.transform = 'rotate(' + rot + 'deg)');
  }
}
LG.Compass = class {
  /**
   * i heading (degrees)
   * i rad
   */
  constructor(heading = 0) {
    this.set(heading);
  }
  set(heading) {
    this.heading = LG.Compass.fix(heading);
    this.rad = this.heading * (Math.PI / 180);
  }
  rotate(deg) {
    this.set(this.heading + deg);
  }
  advanceX(x, steps) {
    return x + Math.cos(this.rad) * steps;
  }
  advanceY(y, steps) {
    return y - Math.sin(this.rad) * steps;
  }
  static radTo(fx, fy, tx, ty) {
    return Math.atan2(fy - ty, tx - fx);
  }
  static fix(heading) {
    heading = heading > 359 ? heading - 360 : heading;
    heading = heading < 0 ? heading + 360 : heading;
    return heading;    
  }
}
class Vector {
  //
  constructor(x = 0, y = 0) {
    this.x = x;
    this.y = y;
  }
  nonzero() {
    return this.x || this.y;
  }
  reset() {
    this.x = 0;
    this.y = 0;
  }
  add(that, max) {
    this.x += that.x;
    this.y += that.y;
    if (max) {
      if (Math.abs(this.x) > max) {
        this.x = Math.sign(this.x) * max;
      }
      if (Math.abs(this.y) > max) {
        this.y = Math.sign(this.y) * max;
      }  
    }
  }
  //
  static byRadians(rad, mag = 1) {
    return new Vector(mag * Math.cos(rad), mag * -Math.sin(rad));
  }
}
function animate($e, css, onend) {
  $e.style.animation = css;
  $e.on_once('animationend', e => {
    $e.style.animation = '';
    onend && onend(e);
  })
}
class Controller extends LG.Controller {
  /**
   * i mx, my
   * Sprites sprites (ship, rocks, ship shots, ufo, ufo shot)
   * Mode mode 
   * Ship ship
   * Rocks rocks
   * Ufo ufo (while active)
   * Zone zone (ship spawning zone, to be clear of rocks)
   * Scoreboard scoreboard
   * Script script
   * Scores highscores 
   * i rocksleft
   * i halfrocks (to identify when half the rocks are cleared)
   * i ufos (number of ufos spawned on this board)
   * i lastufo (fix of last ufo shot)
   * i lastrock (fix of last rock shot)
   */
  constructor() {
    super();
    this.mx = window.innerWidth;
    this.my = window.innerHeight;
    this.zone = new Zone(this.mx, this.my);
    this.highscores = new Scores();
    this.scoreboard = new Scoreboard(5, this.highscores.topScore());
    this.highscorelist = new HighScoreList(this.highscores);
    this.entry = new ScoreEntry();
    this.script = new Script();
    this.ship = new Ship()
      .on('explode', () => this.ship_onexplode())
      .on('dead', () => this.ship_ondead());
    this.mode = new Mode()
      .on('nextboard', () => this.nextBoard());
    window
      .on('keydown', e => this.onkeydown(e))
      .on('keyup', e => this.onkeyup(e))
      .on('resize', e => {
        this.mx = window.innerWidth;
        this.my = window.innerHeight;
      })
    this.demo();
  }
  demo(showHighScores = false) {
    this.mode.setDemo(showHighScores);
    this.ship.dead = 1;
    this.script.reset();
    this.killSprites();
    this.sprites = new LG.Sprites();
    this.scoreboard.show(0);
    this.highscorelist.show(1);
    this.start(1);
    this.nextBoard();
  }
  newGame() {
    this.mode.start();
    this.ship.reset(this.mx, this.my);
    this.script.reset();
    this.scoreboard.show(1).reset();
    this.highscorelist.show(0);
    this.killSprites();
    this.sprites = new LG.Sprites(this.ship);
    this.start(1);
    $('#start').style.display = 'block';
    animate($('#start'), 'textgrow 3s 1', () => {
      $('#start').style.display = '';
    })
  }
  nextBoard() {
    this.mode.set(Mode.GAME_IN_PROGRESS);
    this.lastufo = this.fix;
    this.lastrock = this.fix;
    this.ufos = 0;
    this.ufo = null;
    if (this.mode.demo && this.script.rocks == 12) {
      this.script.reset();
    }
    this.script.next();
    this.rocks = Rock.asBigs(this.script, this.mx, this.my);
    this.rocksleft = this.totalRocksLeft();
    this.halfrocks = this.rocksleft / 2;
    this.sprites.append(this.rocks);
  }
  enterScore(fn) {
    this.mode.entering = 1;
    this.entry.show((inits) => fn(inits));
  }
  step(fix) {
    if (this.rocksleft && fix > 50) {
      let b = Math.floor(this.rocksleft / this.halfrocks * 25) + 10;
      if (fix % b == 0) {
        Sounds.beat();
      }
    }
    super.step(fix);
    this.mode.step();
    if (this.mode.is(Mode.GAME_STARTING) || this.mode.is(Mode.BOARD_FINISHING)) {
      this.wrap(this.ship);
      return;
    }
    this.checkUfoSpawn();
    this.checkCollisions();
    this.sprites = this.sprites.filter(sprite => ! sprite.dead);
    this.sprites.forEach(sprite => this.wrap(sprite));
    if (this.rocksleft == 0 && ! this.ufo) {
      this.board_onfinish();
    }
    this.checkZone();
  }
  killSprites() {
    this.sprites.forEach(sprite => {
      if (Rock.is(sprite)) {
        sprite.kill();
      } else if (Ufo.is(sprite) || Shot.is(sprite)) {
        sprite.kill(1);
      }
    })
  }
  ship_ondead() {
    if (this.scoreboard.gameover()) {
      Sounds.mute();
      $('#gameover').style.display = 'block';
      let nhs = this.highscores.qualifies(this.scoreboard.score);
      animate($('#gameover'), 'textgrow 3s 1', () => {
        if (! nhs) {
          wait(3000, () => {
            $('#gameover').style.display = '';
            this.demo(1);  
          })
        }
      })
      if (nhs) {
        this.enterScore(inits => {
          $('#gameover').style.display = '';
          this.highscores.record(this.scoreboard.score, inits);
          this.scoreboard.highscore(this.highscores.topScore());
          this.highscorelist.draw();
          this.demo(1);    
        })
      }
    } else {
      this.checkZoneClear = 1;
    }
  }
  ship_onexplode() {
    this.scoreboard.die();
  }
  zone_onsafe() {
    this.sprite(this.ship.reset(this.mx, this.my));
  }
  board_onfinish() {
    this.mode.finish();
  }
  totalRocksLeft() {    
    let left = 0;
    this.rocks.forEach(rock => left = left + (rock.type == 'rb' ? 7 : (rock.type == 'rm' ? 3 : 1)));
    return left;
  }
  checkUfoSpawn() {
    if (this.ufo) {
      return;
    }
    if (! this.mode.demo && ! this.ship.alive()) {
      return;
    }
    let mar = this.script.board < 5 ? 250 : this.script.board < 7 ? 200 : 150;
    if (this.lastufo && this.fix - this.lastufo < mar) {
      return;
    }
    let cls;
    if ((this.fix - this.lastrock > mar) || (this.ufos == 0 && this.rocksleft <= this.halfrocks) || (this.script.board >= 5 && this.rocksleft <= 4)) {
      cls = 'ub';
      if (this.rocksleft <= 6 || this.scoreboard.score > 40000) {
        cls = 'us';
      }
      if (this.script.board > 1 && this.ufos > 3) {
        cls = 'us';
      }
      if (this.script.board > 4 && this.ufos > 2) {
        cls = 'us';
      }
      if (this.script.board == 1 && this.ufos < 3) {
        cls = 'ub';
      }
      if (this.scoreboard.gameover()) {
        cls = 'us';
      }
      if (this.mode.demo) {
        cls = rnd(4) == 0 ? 'ub' : 'us';
      }
    }
    if (cls) {
      this.ufos++;
      this.ufo = this.sprite(Ufo.create(this.ship, this.rocks, cls, this.mx, this.my, this.script.sf, this.mode.demo)
        .on('shoot', shot => this.sprite(shot)));
    }
  }
  checkCollisions() {
    let newRocks = [];
    let rockhit = 0;
    this.sprites.of(Shot).forEach(shot => {
      let target = this.checkShot(shot);
      if (target) {
        if (shot.type == 1) {
          this.scoreboard.add(target.worth());
        }
        shot.kill(1);
        if (Rock.is(target)) {
          target.kill(newRocks);
          rockhit = 1;
          if (shot.type == 1) {
            this.lastrock = this.fix;
          }
        } else {
          target.kill();
        }
      }        
    })
    let sb = this.ship.bounds();
    if (this.ufo) {
      if (this.ship.alive() && this.ufo.withinCircle(sb.cx, sb.cy)) {
        this.scoreboard.add(this.ufo.worth());
        this.ufo.kill();
        this.ship.kill();
      } else {
        let b = this.ufo.bounds();
        let rock = this.checkRocks(b);
        if (rock) {
          this.ufo.kill(rock);
          rock.kill(newRocks);
          rockhit = 1;
        }
      }
      if (this.ufo.dead) {
        this.ufo = null;
        this.lastufo = this.fix;
      }
    }
    if (this.ship.alive()) {
      let rock = this.checkRocks(sb);
      if (rock) {
        this.scoreboard.add(rock.worth());
        this.ship.kill(rock);
        rock.kill(newRocks);
        rockhit = 1;
      }
    }
    if (newRocks.length) {
      this.sprites = this.sprites.concat(newRocks);
    }
    if (rockhit) {
      this.rocks = this.sprites.alive(Rock);
      this.rocksleft = this.totalRocksLeft();
      if (this.ufo) {
        this.ufo.loadRocks(this.rocks);
      }
    }
  }
  checkRocks(b) {
    let hit = 0;
    this.sprites.alive(Rock).forEach(rock => {
      if (! hit && rock.withinCircle(b.cx, b.cy)) {
        hit = rock;
      }
    })
    return hit;
  }
  checkShot(shot) {
    let b = shot.bounds(), target;
    this.sprites.alive().forEach(s => {
      if (s.contains(b.cx, b.cy)) {
        if (Rock.is(s) || (Ship.is(s) && shot.type == 2) || (Ufo.is(s) && shot.type == 1)) {
          target = s;
        }
      }
    })
    return target;
  }
  checkZone() {
    if (! this.checkZoneClear || (this.ufo && this.ufo.type == 2)) {
      return;
    }
    let safe = true;
    this.sprites.of(Rock).forEach(rock => {
      if (this.zone.contains(rock)) {
        safe = false;
      }
    })
    if (safe) {
      this.checkZoneClear = 0;
      this.zone_onsafe();
    }
  }
  wrap(sprite) {
    let b = sprite.bounds();
    if (! Ufo.is(sprite)) {
      if (b.x < 0) {
        sprite.moveTo(this.mx - b.width, b.y);
      } else if (b.x2 > this.mx) {
        sprite.moveTo(0, b.y);
      }
    }
    if (b.y < 0) {
      sprite.moveTo(b.x, this.my - b.height);
    } else if (b.y2 > this.my) {
      sprite.moveTo(b.x, 0);
    }
  }
  onkeydown(e) {
    if (this.mode.demo || this.mode.entering) {
      return;
    }
    switch (e.key) {
      case 'A':
      case 'a':
      case 'ArrowLeft':
        this.ship.turn(-1);
        break;
      case 'S':
      case 's':
      case 'ArrowRight':
        this.ship.turn(1);
        break;
      case 'K':
      case 'k':
      case 'ArrowUp':
        this.ship.thrust(1);
        break;
      case 'L':
      case 'l':
      case 'ArrowDown':
        let shot = this.ship.shoot();
        if (shot) {
          this.sprites.push(shot);
        }
        break;
      case ' ':
        this.ship.hyperspace();
        break;
      case 'P':
      case 'p':
        this.pause();
        break;
    }
  }
  onkeyup(e) {
    if (this.mode.demo) {
      switch (e.key) {
        case '1':
          Sounds.start();
          this.newGame();
      }
      return;
    }
    if (this.mode.entering) {
      this.entry.onkeyup(e);
      return;
    }
    switch (e.key) {
      case 'A':
      case 'a':
      case 'S':
      case 's':
      case 'ArrowLeft':
      case 'ArrowRight':
        this.ship.turn(0);
        break;
      case 'K':
      case 'k':
      case 'ArrowUp':
        this.ship.thrust(0);
        break;
      }
  }
}
class Mode extends Obj {
  onnextboard() {}
  //
  constructor() {
    super();
    this.reset();
  }
  reset() {
    this.mode = 0;
    this.demo = 0;
    this.entering = 0;
    this.starting = 0;
    this.finishing = 0;
  }
  set(mode) {
    this.mode = mode;
  }
  setDemo(showHighScores = false) {
    this.demo = 1;
    this.entering = 0;
    if (showHighScores) {
      $('#highscores').style.display = 'block';
    } else {
      $('#welcome').style.display = 'block';
    }
    this.demob = ! showHighScores;
  }
  is(mode) {
    return this.mode == mode;
  }
  start() {
    this.reset();
    this.mode = Mode.GAME_STARTING;
    this.starting = 1;
    $('#welcome').style.display = '';
    $('#highscores').style.display = '';
}
  finish() {
    this.mode = Mode.BOARD_FINISHING;
    this.finishing = 1;
  }
  step() {
    if (this.demo) {
      this.demo++;
      if (this.demo % 1000 == 0) {
        this.demob = ! this.demob;
        if (this.demob) {
          $('#welcome').style.display = 'block';
          $('#highscores').style.display = '';
        } else {
          $('#welcome').style.display = '';
          $('#highscores').style.display = 'block';
        }
      }
    }
    if (this.starting) {
      this.starting++;
      if (this.starting > 150) {
        this.starting = 0;
        this.onnextboard();
      }
      return;
    }
    if (this.finishing) {
      this.finishing++;
      if (this.finishing > 150) {
        this.finishing = 0;
        this.onnextboard();
      }
      return;
    }
  }
  //
  static GAME_STARTING = 1;
  static GAME_IN_PROGRESS = 2;
  static BOARD_FINISHING = 3;
}
class Scores extends StorableObj {
  /**
   * scores[] [{score:100,inits:'WGH'},..]
   */
  constructor() {
    super('Asteroids.Scores');
    this.scores = this.scores || Scores.CANNED;
  }
  topScore() {
    return this.scores[0]?.score;
  }
  bottomScore() {
    return this.scores.length < Scores.MAX ? 0 : this.scores[this.scores.length - 1].score;
  }
  forEach(fn) {
    this.scores.forEach((item, i) => fn(item, i));
  }
  qualifies(score) {
    if (score == 0) {
      return false;
    }
    let bs = this.bottomScore();
    return this.scores.length == Scores.MAX ? score > bs : score >= bs;
  }
  record(score, inits) {
    if (! this.qualifies(score)) {
      return;
    }
    let ins = 0;
    for (let i = this.scores.length - 1; i >= 0; i--) {
      if (score <= this.scores[i].score) {
        ins = i + 1;
        break;
      } 
    }
    if (ins < Scores.MAX) {
      this.scores.splice(ins, 0, {'score':score, 'inits':inits});
    }
    if (this.scores.length > Scores.MAX) {
      this.scores.length = Scores.MAX;
    }
    this.save();
  }
  static MAX = 10;
  static CANNED = [{score:990,inits:'UFO'},{score:520,inits:'ET'},{score:330,inits:'ALF'},{score:100,inits:'MTM'}]
}
class Script {
  /**
   * i board
   * d sf (speed factor, initially 1.0)
   * i rocks (initially 4)
   * i color (of rocks)
   */
  constructor() {
    this.reset();
  }
  reset() {
    this.board = 0;
    this.rocks = 2;
    this.sf = 1;
    this.color = 39;
    this.sat = 18;
  }
  next() {
    this.board++;
    this.ufos = 0;
    if (this.rocks < 12) {
      this.rocks += 2;
    } else if (this.sf == 1) {
      this.sf += 0.1;
      this.color = 96;
      this.sat = 20;
    } else if (this.sf < 1.2) {
      this.sf += 0.1;
      this.color += 50;
      this.sat += 30;
    } else if (this.sf < 1.6) {
      this.sf += 0.1;
      this.color += 50;
      this.sat += 30;
      this.inc = 30;
    } else if (this.sf < 1.9) {
      this.sf += 0.1;
      this.color += this.inc;
      this.sat = 100;
      this.inc -= 40;
    } else {
      this.color = '#000';
      this.sat = 0;
      this.rocks += 2;
      return;
    }
    if (this.color > 360) {
      this.color -= 360;
    }
  }
}
class Zone {
  //
  constructor(mx, my) {
    this.x = mx / 2;
    this.y = my / 2;
    this.r = 130;
  }
  contains(rock) {
    return rock.distanceFrom(this.x, this.y) <= this.r;
  }
}
class HighScoreList extends LG.Obj {
  //
  constructor(scores) {
    super();
    this.scores = scores;
    this.$highscores = $('#highscores');
    this.$list = $('#list');
    this.draw();
  }
  show(b) {
    this.$highscores.classList.toggle('hide', ! b);
    $('#press1').classList.toggle('hide', ! b);
  }
  draw() {
    var h = [];
    this.scores.forEach((e, i) => {
      h.push('<div><span class="rank">');
      h.push(i + 1);
      h.push('.</span><span class="score">');
      h.push(e.score);
      h.push('</span><span class="inits">');
      h.push(e.inits);
      h.push('</span>');
      h.push('</div>');
    })
    this.$list.innerHTML = h.join('');
  }
}
class Scoreboard extends LG.Obj {
  /**
   * i lives
   * i score
   */
  constructor(lives, highscore) {
    super();
    this.$score = $('#score');
    this.$highscore = $('#highscore');
    this.$highscore.innerText = '00';
    this._lives = lives;
    this.ships = [];
    this.reset();
    this.highscore(highscore);
  }
  show(b) {
    //this.$score.classList.toggle('hide', ! b);
    this.ships.forEach(life => life.show(b));
    return this;
  }
  reset() {
    this.score = 0;
    this.$score.innerText = '00';
    this.lb = 0;
    while (this.ships.length) {
      this.ships.pop().kill(1);
    }
    this.lives = this._lives;
    this.draw();
  }
  highscore(i) {
    if (i) {
      this.$highscore.innerText = i;
    }
  }
  add(i) {
    this.score += i;
    this.$score.innerText = this.score;
    if ((this.score - this.lb) >= 10000) {
      this.bonus();
      this.lb += 10000;
    }
  }
  bonus() {
    this.lives++;
    this.draw();
  }
  die() {
    this.lives--;
    this.draw();
  }
  gameover() {
    return this.lives == 0;
  }
  //
  draw() {
    var s = this.ships.length;
    var d = this.lives - s;
    if (d == -1) {
      this.ships.pop().kill(1);
    } else {
      for (var i = 0; i < d; i++) {
        let x = 220 + s * 25 + i * 25;
        this.ships.push(new Life(x, 25));
      }
    }
  }
}
class Life extends LG.Sprite {
  //
  constructor(x, y) {
    super($('#screen'), $('#shipbp').innerHTML, 'life', x, y, 90, 90);
  }
}
class Ship extends LG.Sprite {
  onexplode() {}
  ondead() {}
  //
  constructor() {
    super($('#screen'), $('#shipbp').innerHTML, 'ship', 0, 0, 90);
    this.shots = [];
    this.show(0);
  }
  reset(mx, my) {
    this.moveTo(mx / 2 - 20, my / 2 - 20).heading(0);
    this.dead = 0;
    this.thrusting = 0;
    this.exploding = 0;
    this.hypering = 0;
    this.hypers = 0;
    this.accel = new Ship.Acceleration();
    this.speed = new Ship.Velocity();
    this.rot = 0;
    this.show(1);
    return this;
  }
  step(fix) {
    if (this.exploding) {
      this.forward();
      if (this.thrusting) {
        this.accel.off();
      }
      if (this.speed.nonzero()) {
        this.speed.friction();
      }
      return;
    }
    if (this.rot) {
      let deg = this.rot * Ship.ROTC;
      this.rotate(deg);
    }
    this.forward();
    if (fix % 5 == 0) {
      if (this.thrusting) {
        this.accel.thrust(this.compass);
        this.speed.accelerate(this.accel);
      } else {
        this.accel.off();
      }
      if (this.speed.nonzero()) {
        this.speed.friction();
      }
    }
    this.shots = this.shots.filter(shot => ! shot.dead);
  }
  alive() {
    return ! this.dead && ! this.exploding && ! this.hypering;
  }
  turn(dir/*-1=left, +1=right, 0=off*/) {
    this.rot = -dir;
  }
  thrust(on/*1=on, 0=off*/) {
    if (on && ! this.alive()) {
      return;
    }
    this.thrusting = on;
    this.$$frames[1].classList.toggle('thrusting', on);
  }
  shoot() {
    if (! this.alive() || this.shots.length >= 4) {
      return;
    }
    let shot = Shot.fromShip(this);
    this.shots.push(shot);
    Sounds.fireShip();
    return shot;
  }
  hyperspace() {
    if (! this.alive()) {
      return;
    }
    this.hypering = 1;
    animate(this.$frame, 'hyperout 0.4s normal 1', () => {
      this.show(0);
      this.moveTo(rnd(window.innerWidth), rnd(window.innerHeight));
      this.show(1);
      animate(this.$frame, 'hyperin 0.4s normal 1', () => {
        this.hypering = 0;
        this.hypers++;
        if (this.hypers > 2) {
          if (rnd(12 - this.hypers) == 0) {
            this.kill();
          }
        }    
      });
    });
  }
  kill(rock) {    
    if (rock) {
      let sf = rock.type == 'rb' ? 4 : rock.type == 'rm' ? 2 : 1;
      this.speed.add(Vector.byRadians(rock.compass.rad, rock.speed * sf));
    }
    this.onexplode();
    this.explode(() => {
      super.kill();
      this.show(0);
      this.ondead();
    });
  }
  explode(ondone) {
    this.exploding = 1;
    this.thrust(0);
    let b = this.bounds();
    let $e = document.createElement('div');
    $e.className = 'pow xship';
    $e.innerHTML = $('#powbp').innerHTML;
    $('#screen').appendChild($e);
    $e.style.left = b.x - 25;
    $e.style.top = b.y - 25;
    animate(this.$frame, 'dive 4s normal 1', () => {
      $e.remove();
      ondone();
    })
    Sounds.explodeBig();
  }
  worth() {
    return 0;
  }
  forward() {
    if (this.speed.nonzero()) {
      this.moveByVector(this.speed);
    }
  }
  moveTo(x, y) {
    return super.moveTo(x, y);
  }
  //
  static ROTC = 5.6;
}
Ship.Velocity = class extends Vector {
  //
  constructor() {
    super();
  }
  accelerate(accel) {
    this.add(accel, Ship.Velocity.MAX);
  }
  friction() {
    this.x = this.dimin(this.x);
    this.y = this.dimin(this.y);
  }
  dimin(e) {
    if (e == 0 || Math.abs(e) < 0.1) {
      return 0;
    }
    return e * Ship.Velocity.FC;
  }
  static FC = 0.95;
  static MAX = 20;
}
Ship.Acceleration = class extends Vector {
  //
  constructor() {
    super();
    this.reset();
  }
  reset() {
    super.reset();
    this.ac = 0.72;
  }
  thrust(compass) {
    let v = Vector.byRadians(compass.rad, this.ac);
    this.add(v, Ship.Acceleration.MAX);    
    this.ac = Ship.Acceleration.AC;
  }
  off() {
    this.reset();
  }
  static MAX = 20;
  static AC = 0.2;
}
class Shot extends LG.Sprite {
  /**
   * i type 1=ship 2=ufo
   */
  constructor(bounds, speed, rad, type, max, ufo) {
    super($('#screen'), null, 'shot ' + (type == 1 ? 'sshot' : 'ushot'), bounds.cx - 2, bounds.cy - 2);
    this.velocity = new Shot.Velocity(rad, speed, ufo);
    this.type = type;
    this.steps = 0;
    this.max = max || Shot.STEPS;
  }
  step() {
    this.moveByVector(this.velocity);
    this.steps++;
    if (this.steps > this.max) {
      this.kill(1);
    }
  }
  hits(sprites) {
    let b = this.bounds(), hit;
    return hit;
  }
  //
  static fromShip(ship) {
    return new Shot(ship.bounds(), ship.speed, ship.compass.rad, 1);
  }
  static fromUfo(ufo, rad) {
    let max = ufo.type == 1 ? 48 : 54;
    return new Shot(ufo.bounds(), null, rad, 2, max, ufo);
  }
  static STEPS = 45;
}
Shot.Velocity = class extends Vector {
  //
  constructor(rad, shipv, ufo) {
    super();
    if (shipv) {
      let v = Vector.byRadians(rad, Shot.Velocity.FROM_SHIP);
      this.x = this.merge(v.x, shipv.x * 1.2);
      this.y = this.merge(v.y, shipv.y * 1.2);
    } else {
      let v = Vector.byRadians(rad, ufo.type == 1 ? 16 : 20);
      this.x = v.x;
      this.y = v.y;
    }
  }
  merge(m, s) {
    return (Math.abs(m + s) < Math.abs(m)) ? m + s : m;
  }
  static FROM_SHIP = 24;
}
class Thruster extends LG.Sprite {
  //
  constructor(x, y) {
    super($('#screen'), $('#thrustbp').innerHTML, 'thrust', x, y, 90);
    this.thrust(0);
  }
  thrust(on) {
    this.$e.className = on ? 'thrust thrusting' : 'thrust hide';
  }
}
class Rock extends LG.Sprite {
  /**
   * sf speed factor
   * type 'rb', 'rm', or 'rs'
   */
  constructor(x, y, cls, sf, speed, vmin, vmax, minHead = 0, maxHead = 359) {
    let r = rnd(2);
    let fcls = r == 0 ? 'rock ccw ' + cls : 'rock ' + cls;
    if (minHead > maxHead) {
      minHead = r ? minHead : 0;
      maxHead = r ? 359 : maxHead;
    }
    let deg = minHead + rnd(maxHead - minHead + 1);
    let html = $('#rockbp1').innerHTML.replace('39', Rock.color).replace('18', Rock.sat);
    super($('#screen'), html, fcls, x, y);
    this.type = cls;
    this.sf = sf;
    this.rotate(deg);
    r = 1 + ((rnd(vmin + vmax) - vmin) / 100);
    this.speed = speed * r * sf * 1.5;
  }
  step(fix) {
    this.advance(this.speed);
  }
  kill(newRocks) {
    if (newRocks) {
      let b = this.bounds();
      this.shot(b, newRocks);
      this.explode(b);
    }
    super.kill(1);
  }
  withinCircle(x, y) {
    return super.withinCircle(x, y, 1.5);
  }
  shot(b, newRocks) {
    if (this.type == 'rb') {
      newRocks.push(Rock.asMedium(b.cx - 30, b.cy - 30, this.sf));
      newRocks.push(Rock.asMedium(b.cx - 30, b.cy - 30, this.sf));
    } else if (this.type == 'rm') {
      newRocks.push(Rock.asSmall(b.cx - 15, b.cy - 15, this.sf));
      newRocks.push(Rock.asSmall(b.cx - 15, b.cy - 15, this.sf));
    }
  }
  explode(b) {
    let $e = document.createElement('div');
    $e.style.left = b.x;
    $e.style.top = b.y;
    $e.className = 'xrock x' + this.type;
    $e.innerHTML = $('#xrockbp').innerHTML;
    $('#screen').appendChild($e);
    animate($e, 'agrow 0.4s linear 1', () => $e.remove());
    Sounds.explode(this.type);
    return this;
  }
  worth() {
    switch (this.type) {
      case 'rb':
        return 20;
      case 'rm':
        return 50;
      case 'rs':
        return 100;
    }
  }
  //
  static asBigs(script, mx, my) {
    let us = [], x, y, min, max, edge;
    Rock.color = script.color;
    Rock.sat = script.sat;
    for (let i = 0; i < script.rocks; i++) {
      edge = (rnd(mx + my) < mx) ? rnd(2) * 2 : rnd(2) * 2 + 1;
      switch (edge) {
        case 0:
          x = rnd(mx - 120), y = 0;
          min = 210, max = 330;
          break;
        case 1:
          x = mx - 120, y = rnd(my - 120);
          min = 120, max = 240;
          break;
        case 2:
          x = rnd(mx - 120), y = my - 120;
          min = 30, max = 150;
          break;
        case 3:
          x = 0, y = rnd(my - 120);
          min = 300, max = 60;
          break;
      }
      us.push(Rock.asBig(x, y, script.sf, min, max));
    }
    return us;
  }
  static asBig(x, y, sf, minHead, maxHead) {
    return new Rock(x, y, 'rb', sf, 0.7, 30, 50, minHead, maxHead);
  }
  static asMedium(x, y, sf) {
    return new Rock(x, y, 'rm', sf, 1, 50, 70);
  }
  static asSmall(x, y, sf) {
    return new Rock(x, y, 'rs', sf, 1.5, 60, 80);
  }
}
class Ufo extends LG.Sprite {
  onshoot(shot) {}
  //
  constructor(ship, rocks, x, y, cls, speed, x1, y1, x2, demo) {
    super($('#screen'), $('#ufobp').innerHTML, 'ufo ' + cls, x, y);
    this.ship = ship;
    this.demo = demo;
    this.shooting = 0;
    this.type = cls == 'ub' ? 1/*big*/ : 2/*small*/;
    this.shootmod = this.type == 1 ? 50 : 5;
    this.x1 = x1;
    this.y1 = y1;
    this.x2 = x2;
    this.xdir = (x == 0) ? 1 : -1;
    this.ydir = (y <= y1) ? 1 : -1;
    let r = this.ydir == 1 ? 1 : 0;
    let n = (x == 0) ? 1 + r * 10 : 5 + r * 2, rad = (n * Math.PI) / 6;
    this.v0 = new Vector(speed * this.xdir, 0);
    this.v1 = Vector.byRadians(rad, speed);
    this.v = this.v0;
    this.mode = 0/*heading horizontally to x1*/;
    this.rocks = rocks;
  }
  step(fix) {
    if (this.fix0 == null) {
      this.fix0 = fix;
    }
    this.moveByVector(this.v);
    let b = this.bounds();
    switch (this.mode) {
      case 0:
        if (this.past(this.xdir, b.cx, this.x1)) {
          this.mode = 1;
          this.v = this.v1;
        }
        break;
      case 1:
        if (this.past(this.ydir, b.cy, this.y1)) {
          this.mode = 2;
          this.v = this.v0;
        }
        break;
    }
    if (this.past(this.xdir, b.cx, this.x2)) {
      this.kill(1);
    }
    if (! this.shooting) {
      if (fix % this.shootmod == 0 && fix - this.fix0 > 50) {
        this.shoot();
      }
    } else {
      if (this.shooting.dead) {
        this.shooting = null;
      }
    }
  }
  loadRocks(rocks) {
    this.rocks = rocks;
  }
  shoot() {
    if (! this.alive() || this.shooting) {
      return;
    }
    if (! this.ship.alive()) {
      if (this.type == 1 && ! this.demo) {
        return;
      }
      this.rockmode = 1;
    } else {
      this.rockmode = 0;
    }
    let rad;
    if (this.type == 1) {
      rad = rnd(628) / 100;
    } else {
      let ub = this.bounds(), sb, fudge;
      if (this.rockmode && this.rocks.length == 0) {
        return; 
      } else {
        if (this.rocks.length && (this.rockmode || rnd(4) == 1)) {
          let md = 2000, d, rb, rs;
          this.rocks.forEach(rock => {
            rb = rock.bounds();
            d = this.distanceFrom(rb.cx, rb.cy, ub);
            if (d < md) {
              sb = rb;
              md = d;
              rs = rock.speed;
            }
          })
          fudge = (md / 1000) * 0.05 * (rnd(2) * -2 + 1);
          fudge *= rs;
        } else {
          sb = this.ship.bounds();
          fudge = (rnd(30) - 15) / 50;
        }
        rad = LG.Compass.radTo(ub.cx, ub.cy, sb.cx, sb.cy) + fudge;
      }
    }
    this.shooting = Shot.fromUfo(this, rad);
    animate(this.$frame, 'ufobulge 0.5s linear 1');
    Sounds.fireUfo();
    this.onshoot(this.shooting);
  }
  kill(rock) {
    if (rock == 1/*ufo went off screen*/) {
      return super.kill(1);
    }
    if (rock) {
      let sf = rock.type == 'rb' ? 4 : rock.type == 'rm' ? 2 : 1;
      this.v.add(Vector.byRadians(rock.compass.rad, rock.speed * sf));
    }
    this.explode(() => {
      super.kill(1);
    })
  }
  explode(ondone) {
    this.dead = 1;
    let b = this.bounds();
    let $e = document.createElement('div');
    $e.className = 'pow ' + (this.type == 1 ? 'xufob' : 'xufos');
    $e.innerHTML = $('#ufopowbp').innerHTML;
    $('#screen').appendChild($e);
    $e.style.left = b.x - (this.type == 1 ? 20 : 10);
    $e.style.top = b.y - (this.type == 1 ? 20 : 10);
    this.show(0);
    Sounds.explodeMedium();
    wait(1000, () => {
      $e.remove();
      ondone();
    })
  }
  worth() {
    return this.type == 1 ? 200 : 1000;
  }
  past(dir, bval, val) {
    return dir == 1 ? bval >= val : bval <= val;
  }
  //
  static create(ship, rocks, cls, mx, my, sf, demo) {
    let w = cls == 'ub' ? 60 : 30;
    let edge = rnd(2) * 2 + 1;
    let x, y, x1, y1, x2;
    switch (edge) {
      case 1:
        x = mx - w, y = rnd(my - w);
        x1 = mx - 200 - rnd(mx / 2), x2 = 0;
        break;
      case 3:
        x = 0, y = rnd(my - w);
        x1 = 200 + rnd(mx / 2), x2 = mx - w;
        break;
    }    
    y1 = rnd(my - 120);
    let speed = (cls == 'ub' ? 3 : 4) * sf;
    return new Ufo(ship, rocks, x, y, cls, speed, x1, y1, x2, demo);
  }
}
class ScoreEntry extends Obj {
  //
  constructor() {
    super();
    this.$congrats = $('#congrats');
    this.$$inits = $$('#inits span');
  }
  reset() {
    this.ic = 0;
    this.$$inits.forEach($span => this.clear($span));
    this.cursor();
  }
  show(onenter) {
    this.reset();
    this.$congrats.style.display = 'block';
    animate(this.$congrats, 'textgrow 2s 1');
    this.onenter = onenter;
  }
  close() {
    this.$congrats.style.display = '';
  }
  onkeyup(e) {
    let s = e.key.toUpperCase();
    if (s == 'ENTER') {
      let inits = this.value();
      if (inits.length) {
        this.close();
        this.onenter(inits);
      }
      return;
    }
    if (s == 'BACKSPACE') {
      this.back();
      return;
    }
    if (this.ic > 3) {
      return;
    }
    if (s == ' ') {
      if (this.ic > 0) {
        this.set(s);
      }
      return;
    }
    if (s.length == 1) {
      let c = s.charCodeAt(0);
      if (c >= 65 && c <= 90) {
        this.set(s);
        return;
      }
    }
  }
  set(s) {
    if (this.ic < 3) {
      this.$$inits[this.ic].innerText = s;
      this.ic++;
      this.cursor();
    }
  }
  back() {
    if (this.ic > 0) {
      this.ic--;
      this.clear(this.$$inits[this.ic]);
      this.cursor();
    }
  }
  value() {
    let v = '';
    this.$$inits.forEach($span => {
      if ($span.innerText.length == 1) {
        v += $span.innerText;
      }
    })
    return v.trim();
  }
  clear($span) {
    $span.innerHTML = '&nbsp;';
  }
  cursor() {
    this.$$inits.forEach(($span, i) => $span.classList.toggle('curs', this.ic == i));
  }
}
Sounds = {
  BEAT1:new Audio('audio/BEAT11.wav'),
  BEAT2:new Audio('audio/BEAT21.wav'),
  YOURFIRE:new Audio('audio/YOURFIRE1.wav'),
  UFOFIRE:new Audio('audio/UFOFIRE1.wav'),
  LARGEXPL:new Audio('audio/LARGEXPL1.wav'),
  MEDUMXPL:new Audio('audio/MEDUMXPL1.wav'),
  SMALLXPL:new Audio('audio/SMALLXPL1.wav'),
  LSAUCER:new Audio('audio/LSAUCER.wav'),
  SSAUCER:new Audio('audio/SSAUCER.wav'),
  //
  start:function() {
    if (! this._muted) {
      this._started = 1;
    }
  },
  mute:function(b) {
    this._muted = 1;
  },
  unmute:function() {
    this._muted = 0;
  },
  beat:function() {
    this._b = ! this._b;
    this.play(this._b ? Sounds.BEAT2 : Sounds.BEAT1);
  },
  fireShip:function() {
    this.play(Sounds.YOURFIRE);
  },
  fireUfo:function() {
    this.play(Sounds.UFOFIRE);
  },
  explodeBig:function() {
    this.play(Sounds.LARGEXPL);
  },
  explodeMedium:function() {
    this.play(Sounds.MEDUMXPL);
  },
  explodeSmall:function() {
    this.play(Sounds.SMALLXPL);
  },
  ufoBig() {
    Sounds.SSAUCER.loop = true;
    Sounds.SSAUCER.play();
  },
  explode:function(type) {
    switch (type) {
      case 'rb':
        return this.explodeBig();
      case 'rm':
        return this.explodeMedium();
      case 'rs':
        return this.explodeSmall();
    }
  },
  //
  play:function(a) {
    return;
    if (! this._started || this._muted) {
      return;
    }
    a.pause();
    a.currentTime=0;
    a.play();
  }
}
window.on('DOMContentLoaded', () => new Controller());
</script>