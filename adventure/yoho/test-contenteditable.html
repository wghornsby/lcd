<html>
  <head>
    <style>
DIV#editor {
  height:400px;
  border:1px solid blue;
  padding:1em;
  font-family:'Consolas';
  font-size:9pt;
}      
BLOCKQUOTE {
  margin-left:2ch !important;
}
    </style>
  </head>
  <body>
    <div id='editor' contenteditable></div>
  </body>
<script>
var editor = document.getElementById('editor');
var text = editor.textContent;
editor.addEventListener("input", function() {
  //if (editor.textContent != text) {
    //text = editor.textContent;
    //reformat();
  //}
  let sel = window.getSelection();  
  let selRange = sel.getRangeAt(0);
  sel.collapseToStart();
  sel.modify("move", "backward", "word");
  sel.modify("extend", "forward", "word");
  let word = sel.toString().trim();
  let keyword = word == 'about' || word == 'verbs';
  let bolded = isBolded(sel);
  if (keyword && ! bolded) {
    document.execCommand('bold');
    sel.collapseToEnd();
    document.execCommand('bold');
  } else if (! keyword && bolded) {
    document.execCommand('bold');
    if (isBolded(sel)) {
      document.execCommand('bold');
    }
    sel.collapseToEnd();
  } else {
    sel.removeAllRanges();
    sel.addRange(selRange);  
  }
  console.log(editor.innerHTML);
}, false);
function isBolded(sel) {
  return sel.anchorNode.parentElement.tagName == 'B';
}
function reformat() {
  let html = text, sel = window.getSelection();
  html = html.replaceAll('bold', '<b>bold</b>');
  editor.innerHTML = html;
}
editor.addEventListener("keydown", function(e) {
  if (e.keyCode == 9 && e.shiftKey) {
    e.preventDefault();
    document.execCommand('outdent');
    return;
  } 
  if (e.keyCode == 9) {
    //document.execCommand('insertText', false, '..');
    e.preventDefault();
    document.execCommand('indent');
    return;
  }
  if (e.keyCode == 8) {
    let sel = window.getSelection();  
    let selRange = sel.getRangeAt(0);
    let node = sel.anchorNode, outdent;
    if (node.tagName == 'BLOCKQUOTE') {
      outdent = 1;
    } else {
      if (sel.anchorOffset == 0 && sel.toString().length == 0) {
        if (node.parentElement.tagName == 'BLOCKQUOTE') {
          outdent = 1;
        } else if (tabbed(node)) {
          sel.modify("extend", "backward", "lineboundary");
          if (sel.toString().length == 0) {
            outdent = 1;
          } else {
            sel.removeAllRanges();
            sel.addRange(selRange);  
          }
        }
      }
    }
    if (outdent) {
      e.preventDefault();
      document.execCommand('outdent');
      return;
    }
  }
}, false);
function tabbed(n) {
  let tab = 0;
  while (! tab && n.parentElement.id != 'editor') {
    n = n.parentElement;
    tab = n.tagName == 'BLOCKQUOTE';
  }
  return tab;
}
</script>
</html>
